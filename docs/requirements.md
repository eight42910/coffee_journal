# Coffee Journal - 要件定義書

## プロジェクト概要

コーヒーの抽出記録を管理する Web アプリケーション。バニラ JS で基礎を徹底理解し、後に React/Next.js へ移植する教材プロジェクト。

---

## Phase 1: 最小機能（Week 1, Day 1-2）

### 機能要件

1. **記録の追加**

   - 豆の名前（テキスト）
   - 評価（1-5 の整数）
   - 日付（日付型）
   - 追加ボタンクリックでリストに追加

2. **記録の表示**

   - 追加した記録を一覧表示
   - 最新が上に表示される

3. **記録の削除**
   - 各記録に削除ボタン
   - クリックでリストから削除

### 技術要件

- HTML/CSS/JS の 3 ファイル構成
- DOM 操作: `querySelector`, `addEventListener`, `createElement`
- 配列操作: `push`, `forEach`, `filter`
- 状態管理: グローバル変数 `state = { entries: [] }`

### 画面構成

```
[Coffee Journal]
━━━━━━━━━━━━━━━━━━━━
[記録を追加]
豆の名前: [_______]
評価: [_______]
日付: [_______]
[追加]
━━━━━━━━━━━━━━━━━━━━
[記録一覧]
• Ethiopia Yirgacheffe | ★★★★★ | 2025-01-15 [削除]
• Colombia Supremo | ★★★★☆ | 2025-01-10 [削除]
```

---

## Phase 2: データ永続化（Week 1, Day 3-4）

### 機能要件

4. **データの保存と読み込み**

   - ページをリロードしても記録が残る
   - localStorage を使用

5. **入力バリデーション**
   - 豆名: 必須、1 文字以上
   - 評価: 必須、1-5 の整数
   - 日付: 必須、未来日不可
   - エラーメッセージを表示

### 技術要件

- localStorage API: `setItem`, `getItem`
- JSON: `stringify`, `parse`
- バリデーション関数の作成
- try-catch でエラーハンドリング

---

## Phase 3: 検索とソート（Week 1, Day 5-6）

### 機能要件

6. **検索機能**

   - 豆名でフィルタリング
   - 部分一致、大文字小文字を区別しない
   - リアルタイム検索（入力中に絞り込み）

7. **ソート機能**

   - 日付順（新 → 古 / 古 → 新）
   - 評価順（高 → 低 / 低 → 高）
   - 豆名順（A→Z / Z→A）

8. **統計情報の表示**
   - 全記録数
   - 平均評価（小数点 1 桁）
   - 最高評価の豆

### 技術要件

- 配列メソッド: `filter`, `sort`, `reduce`, `map`
- デバウンス処理（検索入力）
- 純関数化（副作用を分離）

### 画面構成追加

```
[検索] [_______]  [ソート: 日付▼]
━━━━━━━━━━━━━━━━━━━━
統計: 全15件 | 平均★4.2 | 最高: Ethiopia Yirgacheffe
```

---

## Phase 4: URL 同期とテスト（Week 1, Day 7 / Week 2, Day 1-2）

### 機能要件

9. **URL との同期**

   - 検索文字列とソート条件を URL に反映
   - ブラウザの戻る/進むで状態が復元
   - URL を共有すると同じ表示になる

10. **エラー表示の改善**
    - エラーメッセージ専用エリア
    - 3 秒後に自動消去
    - WAI-ARIA 対応（role="alert"）

### 技術要件

- URLSearchParams
- History API: `replaceState`, `popstate`
- アクセシビリティ: ARIA 属性
- 単体テスト: Vitest 導入
  - 純関数のテスト
  - 境界値・異常系のカバー

---

## Phase 5: 追加機能（Week 2, Day 3-5）

### 機能要件

11. **ページネーション**

    - 1 ページ 10 件表示
    - 前へ/次へボタン
    - ページ番号表示

12. **エクスポート機能**

    - JSON 形式でダウンロード
    - CSV 形式でダウンロード

13. **記録の編集**

    - 既存記録をクリックで編集モード
    - 内容を変更して更新

14. **抽出メモ**
    - 各記録にメモ欄追加（任意）
    - 豆の挽き目、湯温、抽出時間など

### 技術要件

- Blob API（ダウンロード）
- 編集モードの状態管理
- フォームの事前入力

---

## Phase 6: リファクタリング（Week 2, Day 6-7）

### 技術要件

15. **モジュール分割**

    ```
    /src
      /logic      # 純関数（フィルタ、ソート、統計）
      /storage    # localStorage操作
      /validation # バリデーション
      /dom        # DOM操作
      main.js     # エントリポイント
    ```

16. **完全な不変性**

    - すべての状態更新を不変的に
    - 元の配列/オブジェクトを変更しない

17. **テストカバレッジ 80%以上**
    - 全純関数をテスト
    - edge case を網羅

---

## 非機能要件

### パフォーマンス

- 1000 件の記録でも検索が 100ms 以内
- デバウンスで不要な再描画を防止

### ユーザビリティ

- フォーム送信後に入力欄をクリア
- 削除時に確認ダイアログ
- キーボード操作対応（Enter で追加、Esc でキャンセル）

### アクセシビリティ

- セマンティック HTML
- フォームに label 紐付け
- エラーは aria-live で通知
- キーボードナビゲーション

### ブラウザ対応

- Chrome/Safari/Firefox 最新版
- モバイル対応（レスポンシブ）

---

## 成果物

### 最終的なファイル構成

```
/coffee-journal
  index.html
  styles.css
  /src
    main.js
    /logic
      filter.js
      sort.js
      stats.js
    /storage
      localStorage.js
    /validation
      validate.js
    /dom
      render.js
  /tests
    logic.test.js
    storage.test.js
    validation.test.js
  package.json
  vite.config.js
```

### 達成基準

- [ ] 全機能が動作する
- [ ] テストカバレッジ 80%以上
- [ ] ゼロから 60 分で再実装できる
- [ ] 各関数の役割を即答できる
- [ ] localStorage の仕組みを説明できる
- [ ] 配列メソッドの使い分けを説明できる
